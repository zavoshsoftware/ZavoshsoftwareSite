@model ViewModels.PageDetailViewModel
@{
    ViewBag.ogType = "article";
    ViewBag.ogUrl = "https://zavoshsoftware.com/page/" + @Model.UrlParameter;
    ViewBag.ogImage = "https://zavoshsoftware.com/" + @Model.ImageUrl;
    ViewBag.ogSitename = "شرکت زاوش";
    ViewBag.Title = Model.TitleTag;
}

@section StructuredData
{
    <link href="/Content/star-rating.min.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="~/Scripts/UI/star-rating.js"></script>
	<script type="application/ld+json">
        {

        "@@context": "http://schema.org",
        "@@type": "NewsArticle ",
        "mainEntityOfPage":
        {
        "@@type":"WebPage",
        "@@id":"@ViewBag.Canonical"
        },
        "headline":"@ViewBag.Title",
        "image":["@ViewBag.image"],
        "datePublished":"@ViewBag.creationDate",
        "dateModified": "@Model.DateModified",
        "author":
        {
        "@@type":"Person",
        "name":"تیم تولید محتوا زاوش"
        },
        "publisher":
        {
        "@@type":"Organization",
        "name":"زاوش",
        "logo":{
        "@@type":"ImageObject",
        "url":"https://zavoshsoftware.com/Images/backgrounds/zavoshlogo.png"
        }
        }
		@*,
        "description":"@ViewBag.Description",
        "aggregateRating":
        {
        "@@type":"AggregateRating",
        "ratingValue":"@ViewBag.rate",
        "bestRating":"5",
        "ratingCount":"@ViewBag.RatingCount"
        }*@
        }
    </script>
    @*<script type="application/ld+json">
        {

        "@@context": "http://schema.org",
        "@@type": "BreadcrumbList",
        "itemListElement":
        [{
        "@@type":"ListItem",
        "position":1,
        "item":{
        "@@id":"https://zavoshsoftware.com",
        "name":"زاوش",
        "image":"https://zavoshsoftware.com/Images/backgrounds/logozavosh.png"
        }
        },
        {
        "@@type":"ListItem",
        "position":2,
        "item":{
        "@@id":"@ViewBag.ListUrl",
        "name":"@ViewBag.ListTitle",
        "image":"https://zavoshsoftware.com/Images/backgrounds/logozavosh.png"
        }
        },
        {
        "@@type":"ListItem",
        "position": 3,
        "item":{
        "@@id":"@ViewBag.Canonical",
        "name":"@ViewBag.Title",
        "image":"@ViewBag.image"
        }
        }
        ]
        }
    </script>*@
    @if (Model.Faqs.Count() == 3)
    {
        <script type="application/ld+json">
            {
            "@@context": "https://schema.org",
            "@@type": "FAQPage",
            "mainEntity": [
            {
            "@@type": "Question",
            "name": "@Model.Faqs.FirstOrDefault().Question",
            "acceptedAnswer": {
            "@@type": "Answer",
            "text": "@Model.Faqs.FirstOrDefault().Answer"
            }
            },{
            "@@type": "Question",
            "name": "@Model.Faqs.Skip(1).FirstOrDefault().Question",
            "acceptedAnswer": {
            "@@type": "Answer",
            "text": "@Model.Faqs.Skip(1).FirstOrDefault().Answer"
            }
            },{
            "@@type": "Question",
            "name": "@Model.Faqs.Skip(2).FirstOrDefault().Question",
            "acceptedAnswer": {
            "@@type": "Answer",
            "text": "@Model.Faqs.Skip(2).FirstOrDefault().Answer"
            }
            }]
            }
        </script>
    }
}
<div id="page-header">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <ol class="breadcrumb"><li><a href="/">زاوش</a></li><li><a href="@ViewBag.ListUrl">@ViewBag.ListTitle</a></li><li class="active">@Model.Title</li></ol>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-sm-8">
            <div class="blog-article">
                <div class="blog-article-thumbnail"><img src="@Model.ImageUrl" alt="@Model.Title" /></div>
                <div class="blog-article-details">
                    <span>@Model.Date</span>
                    <h1>@Model.Title</h1>
                    <p>
                        <i class="miu-icon-other_conversation_review_comment_bubble_talk_outline_stroke"></i>
                        <a href="#Comment">@Model.CommentCount</a>
                    </p>
                </div>
                @Html.Raw(Model.Body)

                @if (Model.HasFaq)
                {
                    <h2 class="faq-section">@Model.FaqTitle</h2>
                    <p>در این قسمت سوالات متداولی که در رابطه با این مطلب وجود دارد را مشاهده می فرمایید.</p>
                    foreach (var faq in Model.Faqs)
                    {
                        <h3>@faq.Question</h3>
                        <p>@faq.Answer</p>
                    }
                }
                <div class="blog-article-author">
                    <div class="blog-article-author-details">
                        <h4>ثبت نظر</h4>
                        <p>اگر سوال یا نظری در مورد مطلب بالا دارید در این قسمت مطرح نمایید. کارشناسان زاوش در اسرع وقت به سوال شما پاسخ داده و از طریق ایمیل به شما اطلاع رسانی خواهد شد</p>
                    </div>
                </div>
                @*<section id="rating">
                    <div class="row blog-rating">
                        <div class="col-md-5"></div>
                        @Html.Partial("FrontEndLayout/_RatingPartial")
                    </div>
                </section>*@
                <section id="Comment">
                    <h3 class="commentlist-title">نظر (@Model.CommentCount)</h3>
                    <ul class="commentlist">
                        @foreach (var comment in Model.Comments)
                        {
                            <li class="comment even thread-even depth-1">
                                <div class="comment-body">
                                    <div class="comment-meta">
                                        <div class="comment-author vcard">
                                            <img class="avatar avatar-80 photo" src="/Images/avatar.jpg" alt="" height='80' width='80'>
                                            <span class="fn" href="#">@comment.ParentCommnets.Name</span>
                                        </div>
                                        <div class="comment-metadata">
                                            <span href="#">@comment.ParentCommnets.CreationDate.ToShortDateString()</span>
                                        </div>
                                    </div>
                                    <div class="comment-content">
                                        <p>
                                            @if (comment.ParentCommnets.Body != null)
                                            {
                                                @Html.Raw(comment.ParentCommnets.Body.Replace(Environment.NewLine, "<br/>"))
                                            }
                                        </p>
                                    </div>
                                    <div class="reply">
                                        <a class="comment-reply-link" href="#" onClick="LeaveComment('@comment.ParentCommnets.Id');return false;" id="reply">پاسخ</a>
                                    </div>
                                </div>
                                <ul>
                                    @foreach (var respond in comment.RespondComments)
                                    {
                                        <li class="comment even thread-even depth-1">
                                            <div class="comment-body">
                                                <div class="comment-meta">
                                                    <div class="comment-author vcard">
                                                        <img class="avatar avatar-80 photo" src="/Images/avatar.jpg" alt="" height='80' width='80'>
                                                        <span class="fn" href="#">@respond.Name</span>
                                                    </div>
                                                    <div class="comment-metadata"><span href="#">@respond.CreationDate.ToShortDateString()</span></div>
                                                </div>
                                                <div class="comment-content"><p>@Html.Raw(respond.Body)</p></div>
                                            </div>
                                        </li>
                                    }
                                </ul>
                            </li>
                        }
                    </ul>
                    <div id="respond">
                        <span class="commentform-title" id="submit-comment">ثبت نظر</span>
                        <div class="alert alert-danger dir-rtl" id="errorDivQ"></div>
                        <div class="alert alert-success dir-rtl" id="SuccessDivQ">پیغام شما با موفقیت ثبت گردید، پس از تایید مدیر سایت نمایش داده خواهد شد.</div>
                        <div id="commentform">
                            <fieldset>
                                <p>
                                    <label for="name">نام</label>
                                    <input id="commentName" type="text" name="name" placeholder="نام">
                                </p>
                                <p>
                                    <label for="email">ایمیل</label>
                                    <input id="commentEmail" type="text" name="email" placeholder="ایمیل">
                                </p>
                                <p>
                                    <label for="message">نظر</label>
                                    <textarea id="commentBody" name="message" rows="8" cols="25" placeholder="نظر"></textarea>
                                </p>
                                <p><input id="btnSubmitComment" class="btn btn-default" onclick="SubmitComment('@ViewBag.id');" type="button" name="button" value="ثبت نظر"></p>
                            </fieldset>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <div class="col-sm-4">
            <aside>
                <div class="widget widget-categories">
                    <div class="widget-title">سایر خدمات</div>
                    <ul>
                        @foreach (var page in Model.SidebarPages)
                        {
                            <li><a href="/page/@page.UrlParameter">@page.Title</a></li>
                        }
                    </ul>
                </div>
            </aside>
        </div>
    </div>
</div>
@section scripts{
    <script src="~/Scripts/UI/custom.js"></script>
}
@section ratingScripts{
    <script>
        jQuery(document).ready(function() {
            $("#input-21f").rating({
                starCaptions: function(val) {
                    if (val < 3) {
                        return val;
                    } else {
                        return 'high';
                    }
                },
                starCaptionClasses: function(val) {
                    if (val < 3) {
                        return 'label label-danger';
                    } else {
                        return 'label label-success';
                    }
                },
                hoverOnClear: false
            });
            var $inp = $('#rating-input');

            $inp.rating({
                min: 0,
                max: 5,
                step: 1,
                size: 'lg',
                showClear: false
            });

            $('#btn-rating-input').on('click',
                function() {
                    $inp.rating('refresh',
                        {
                            showClear: true,
                            disabled: !$inp.attr('disabled')
                        });
                });


            $('.btn-danger').on('click',
                function() {
                    $("#kartik").rating('destroy');
                });

            $('.btn-success').on('click',
                function() {
                    $("#kartik").rating('create');
                });

            $inp.on('rating.change',
                function() {
                    alert($('#rating-input').val());
                });


            $('.rb-rating').rating({
                'showCaption': true,
                'stars': '3',
                'min': '0',
                'max': '3',
                'step': '1',
                'size': 'xs',
                'starCaptions': { 0: 'status:nix', 1: 'status:wackelt', 2: 'status:geht', 3: 'status:laeuft' }
            });
            $("#input-21c").rating({
                min: 0,
                max: 8,
                step: 0.5,
                size: "xl",
                stars: "8"
            });
            //$("#submitRating").click(function () {


        });

        function SubmitRate() {
            var spanStarNumber;
            var starNumber;
            var pageId = '@ViewBag.id';
            var badgeprimary = $(".badge-primary")[0];
            var badgeInfo = $(".badge-info")[0];
            var badgesecondary = $(".badge-secondary")[0];
            var badgewarning = $(".badge-warning")[0];
            if (badgeprimary !== undefined) {
                spanStarNumber = $(".badge-primary")[0].childNodes[0].data;
                starNumber = spanStarNumber;

            } else if (badgeInfo !== undefined) {
                spanStarNumber = $(".badge-info")[0].childNodes[0].data;
                starNumber = spanStarNumber;
            } else if (badgesecondary !== undefined) {
                spanStarNumber = $(".badge-secondary")[0].childNodes[0].data;
                var starNumberSplit = spanStarNumber.split(' ');
                starNumber = starNumberSplit[0];

            } else if (badgewarning !== undefined) {
                spanStarNumber = $(".badge-warning")[0].childNodes[0].data;
                starNumber = spanStarNumber;
            } else {
                spanStarNumber = $(".badge-success")[0].childNodes[0].data;
                starNumber = spanStarNumber;

            }
            $.ajax(
                {
                    url: "/Pages/teststar",
                    data: { rateStar: starNumber, id: pageId},
                    type: "GET"
                }).done(function(result) {
                if (result === "true") {
                    alert('امتیاز شما با موفقیت ثبت شد.');
                } else if (result === "false") {
                    alert('خطایی رخ داد!! مجددا تلاش نمایید');

                }
            });
        }
    </script>
}